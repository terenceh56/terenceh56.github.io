---
const {
  href,
  icon: iconClass,
  children,
  target,
  isActive: isActiveProp,
  ...props
} = Astro.props;
import getUrl from '@/utils/getUrl';

const { pathname } = Astro.url;
let hrefMath = href.split('/');
let pathnameMatch = pathname.split('/');
const isActive = isActiveProp ?? hrefMath[1] === pathnameMatch[1];
---

<div class="relative flex items-center w-auto h-10 box">
  <a
    href={getUrl(href)}
    target={target}
    class:list={[isActive ? 'header-link-active' : '', 'header-link']}
    {...props}
  >
    <i class={iconClass}></i>
    <slot />
    {children.length > 0 && <i class="ri-arrow-down-s-line" />}
  </a>
  {
    children && children.length > 0 && (
      <div class="p-4 border rounded cursor-pointer dropdown bg-skin-fill">
        <ul class="space-y-4 w-28">
          {children.map((child) => (
            <li class="text-center select-none hover:text-skin-active">
              <i class={child.iconClass} />
              <a
                target={child.target ? child.target : '_self'}
                href={getUrl(child.href)}
              >
                {child.name}
              </a>
            </li>
          ))}
        </ul>
      </div>
    )
  }
</div>

<style>
  .dropdown {
    position: absolute;
    top: 100%;
    left: -40%;
    visibility: hidden;
    opacity: 0;
    pointer-events: none;
    transform-origin: top left;
    transition:
      opacity 200ms cubic-bezier(0.16, 1, 0.3, 1),
      visibility 200ms cubic-bezier(0.16, 1, 0.3, 1),
      transform 200ms cubic-bezier(0.16, 1, 0.3, 1);
    transform: translateY(-6px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    border-radius: 0.75rem;
    z-index: 50;
  }

  .box:hover .dropdown {
    visibility: visible;
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
  }

  /* Navbar button styles */
  .header-link {
    display: inline-flex;
    align-items: center;
    padding: 6px 14px;
    border-radius: 9999px;
    border: 1px solid transparent;
    color: rgb(var(--color-text));
    transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    white-space: nowrap;
    font-size: 0.875rem;
    position: relative;
    outline: none !important;
    font-weight: 500;
  }

  .header-link:focus,
  .header-link:focus-visible {
    outline: none !important;
  }

  /* Responsive font sizing for smaller desktop screens */
  @media (min-width: 960px) and (max-width: 1200px) {
    .header-link {
      font-size: 0.8125rem;
      padding: 6px 12px;
    }
  }

  @media (min-width: 1200px) {
    .header-link {
      font-size: 0.875rem;
    }
  }

  .header-link:hover {
    background: rgba(var(--color-text-active), 0.05);
    border-color: rgba(var(--color-text-active), 0.1);
    transform: translateY(-1px);
    color: rgb(var(--color-text-active));
  }

  .header-link-active {
    background: rgba(var(--color-text-active), 0.08);
    border-color: rgba(var(--color-text-active), 0.15);
    color: rgb(var(--color-text-active));
    font-weight: 500;
  }
</style>
