---
import BeyondSurfacePage from '@/layouts/BeyondSurfacePage.astro';
import getUniqueTags from '@/utils/getUniqueTags';
import getPostsByTag from '@/utils/getPostsByTag';
import SearchTitle from '@/components/SearchTitle.astro';
import { formatDate } from '@/utils/formatDate';
import { sortPostsByDate } from '@/utils/sortPostsByDate';
import { getCollectionByName } from '@/utils/getCollectionByName';
import getUrl from '@/utils/getUrl';

export async function getStaticPaths() {
  const reflections = await getCollectionByName('reflections');
  const milestones = await getCollectionByName('milestones');
  const allPosts = [...reflections, ...milestones];
  return getUniqueTags(allPosts).map((tag) => ({
    params: { tag },
  }));
}

const { tag } = Astro.params;
const reflections = await getCollectionByName('reflections');
const milestones = await getCollectionByName('milestones');
const allPosts = [...reflections, ...milestones];
const tagPosts = getPostsByTag(allPosts, tag);
const resultPosts = sortPostsByDate(tagPosts);
---

<BeyondSurfacePage title={tag}>
  <SearchTitle label={tag} />
  <ul class="text-skin-base">
    {
      resultPosts.map((post) => (
        <li style="list-style-type: disc;" class="ml-4 my-2">
          <a href={getUrl('/') + post.collection + '/' + post.slug}>
            <span class="mr-4">{formatDate(post.data.date)}</span>
            <span class="hover:text-skin-active">{post.data.title}</span>
          </a>
        </li>
      ))
    }
  </ul>
</BeyondSurfacePage>
