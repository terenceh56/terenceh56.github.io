---
import BaseHead from '@/components/BaseHead.astro';
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';
import Profile from '@/components/Profile.astro'
import BlogAside from '@/components/BlogAside.astro'
import Comment from '@/components/Comment.astro'
import Donate from '@/components/Donate.astro'
import {donate, comment, config} from "@/consts";

const {frontmatter = {comment: false, donate: false}, hideAside = false} = Astro.props
const gridClass = hideAside ? 'grid grid-cols-1' : 'grid grid-cols-1 lg:grid-cols-4 gap-8'
---

<html lang={config.lang}>
<BaseHead title={Astro.props.title} />

<body class="bg-skin-secondary relative">
{ !hideAside ? <Header/> : null }
<main class="container p-4 pt-20 text-skin-base pb-32 min-h-full relative" id="app">
  <div class={gridClass}>
    <!-- Content column: spans 3 columns on lg and starts at column 1 -->
    <div class={hideAside ? 'col-span-1 mx-auto max-w-3xl' : 'col-span-1 lg:col-span-3 lg:col-start-1'}>
      <div class={hideAside ? 'mx-auto' : ''}>
        <slot></slot>
      {
        donate?.enable && frontmatter.donate &&
        <Donate></Donate>
      }
      {
        comment?.enable && frontmatter.comment &&
        <Comment></Comment>
      }
    </div>

    <!-- Sidebar column: explicitly placed at column 4 on lg to ensure right-side placement -->
    { !hideAside && (
      <div class="col-span-1 lg:col-start-4">
        <div class="space-y-6">
          <div class="sticky top-20">
            <Profile></Profile>
          </div>
          <BlogAside></BlogAside>
        </div>
      </div>
    ) }
  </div>

  <script>
    // If the Profile component (or HTML snippet) is accidentally rendered inside
    // the article content (e.g. due to markdown/html embed), relocate it into
    // the right-hand sidebar container so it appears at the yellow place.
    (function(){
      try {
        const sidebarContainer = document.querySelector('.space-y-6.sticky.top-20');
        if (!sidebarContainer) return;
        // find any profile nodes inside markdown content
        const inContentProfiles = document.querySelectorAll('.markdown-body .site-profile');
        inContentProfiles.forEach(node => {
          // move node to the top of sidebar container
          sidebarContainer.insertBefore(node, sidebarContainer.firstChild);
        });
      } catch (err) { console.error(err); }
    })();
  </script>
  <Footer/>
</main>
</body>
<script>
  document.body.querySelectorAll("a").forEach(item => {
    item.setAttribute("rel", "nofollow noreferrer");
  });
</script>
</html>
