---
import BaseHead from '@/components/BaseHead.astro';
import { ClientRouter } from 'astro:transitions';
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';
import BlogAside from '@/components/BlogAside.astro';
import UnifiedAside from '@/components/UnifiedAside.astro';
import Profile from '@/components/Profile.astro';
import Comment from '@/components/Comment.astro';
import VisitorCounter from '@/components/VisitorCounter.astro';
import { comment, config } from '@/consts';

const {
  frontmatter = { comment: false },
  hideAside = false,
  hideNav = false,
} = Astro.props;
const gridClass = hideAside
  ? 'grid grid-cols-1'
  : 'grid grid-cols-1 lg:grid-cols-4 gap-8';
---

<html lang={config.lang}>
  <head>
    <BaseHead title={Astro.props.title} />
    <ClientRouter />
  </head>

  <body class="bg-skin-secondary relative min-h-screen flex flex-col">
    <Header hideNav={hideNav} />
    <main
      class:list={[
        hideAside ? '' : 'container',
        hideAside ? '' : 'p-4',
        hideAside ? '' : 'pb-8',
        'flex-grow',
        'relative',
        'text-skin-base',
        hideAside ? 'pt-0' : 'pt-20',
      ]}
      id="app"
    >
      <div class={gridClass}>
        <!-- Tags and Recent Articles - Shows fourth on mobile (order-4) -->
        {
          !hideAside && (
            <div class="col-span-1 lg:col-span-1 order-3 lg:order-2 mb-6 lg:mb-0 lg:hidden">
              <div>
                <UnifiedAside />
              </div>
            </div>
          )
        }

        <!-- Desktop Sidebar - Only shows on desktop -->
        {
          !hideAside && (
            <div class="hidden lg:block col-span-1 lg:col-span-1 lg:order-2">
              <div class="lg:sticky lg:top-20 space-y-4">
                <Profile />
                <UnifiedAside />
              </div>
            </div>
          )
        }

        <!-- Main Content - Visible on both mobile and desktop -->
        <div
          class:list={[
            hideAside
              ? 'col-span-1 order-2 lg:order-1'
              : 'col-span-1 lg:col-span-3 order-2 lg:order-1',
            'fade-in-up',
          ]}
        >
          {
            Astro.url.pathname === '/notes/1' && (
              <div class="mb-8 p-4 glass rounded-lg shadow-md">
                <h2 class="text-2xl font-bold italic mb-2">Notes</h2>
                <p class="text-skin-base italic">
                  This section is mainly about my notes on different subjects,
                  mainly aviation, but also some notes made while pursuing my
                  Bachelor's degree.
                  <br />
                  ⚠️ Quick Note: These are personal study notes and
                  interpretations. Please remember that content accuracy or
                  completeness is <strong>not guaranteed</strong>.
                </p>
              </div>
            )
          }
          {
            Astro.url.pathname === '/thoughts/1' && (
              <div class="mb-8 p-4 glass rounded-lg shadow-md">
                <h2 class="text-2xl font-bold italic mb-2">My Thoughts</h2>
                <p class="text-skin-base italic">
                  This section is mainly about my random thoughts, personal
                  opinions, and reflections on different subjects, which might
                  appear to be some more random, less structured thoughts, like
                  quick posts on social media. If you got different thoughts
                  than me, feel free to leave a comment or discuss me via
                  emails.
                </p>
              </div>
            )
          }
          {
            Astro.url.pathname === '/papers/1' && (
              <div class="mb-8 p-4 glass rounded-lg shadow-md">
                <h2 class="text-2xl font-bold italic mb-2">
                  Research Papers and Articles
                </h2>
                <p class="text-skin-base italic">
                  Hi there! This section contains my personal reading notes and
                  interpretations of various academic papers. Please Note:
                  <br />
                  1. All content reflects my individual understanding and
                  perspective and should be treated as a study log, not a
                  definitive academic source.
                  <br />
                  2. I strive for accuracy, but cannot guarantee the absolute
                  correctness or completeness of the summaries.
                  <br />
                  3. Always refer to the original paper for citation or critical
                  information. By proceeding, you agree to these terms. For full
                  details on content usage and liability, please visit{' '}
                  <a
                    href="/disclaimer"
                    class="underline hover:text-skin-active"
                  >
                    Disclaimer
                  </a>
                  .
                </p>
              </div>
            )
          }
          {
            Astro.url.pathname === '/comments/1' && (
              <div class="mb-8 p-4 glass rounded-lg shadow-md">
                <h2 class="text-2xl font-bold italic mb-2">Comments</h2>
                <p class="text-skin-base italic">
                  This is the comment section of the entire site. Feel free to
                  share your thoughts, ask questions, or engage in conversations
                  here. If it doesn't appear on the page, wait for 10 seconds.
                </p>
              </div>
            )
          }
          <slot />

          {comment?.enable && frontmatter.comment && <Comment />}
        </div>
      </div>
    </main>

    <!-- Footer - Centered at bottom on all screen sizes -->
    <footer class="w-full flex justify-center bg-skin-secondary">
      <Footer />
    </footer>

    <!-- Visitor Counter - Fixed bottom right -->
    <VisitorCounter />
  </body><script>
    document.body.querySelectorAll('a').forEach((item) => {
      item.setAttribute('rel', 'nofollow noreferrer');
    });
  </script>
</html>
